- name: Clean database and run Flyway migrations
  run: |
    set -e
    echo "‚öôÔ∏è Dropping and recreating database..."
    mysql -h127.0.0.1 -P3307 -uroot -pDhruvPass!9062297 -e "DROP DATABASE IF EXISTS subscriptions_dhruv; CREATE DATABASE subscriptions_dhruv;"
    
    echo "üöÄ Running Flyway migrations..."
    flyway \
      -url="jdbc:mysql://127.0.0.1:3307/subscriptions_dhruv?allowPublicKeyRetrieval=true&useSSL=false" \
      -user=root \
      -password=DhruvPass!9062297 \
      -locations=filesystem:${{ github.workspace }}/flyway/migrations_initial,filesystem:${{ github.workspace }}/flyway/migrations_incremental \
      -cleanOnValidationError=true \
      migrate
